(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=[].slice,D={}.hasOwnProperty,E=function(a,b){function c(){this.constructor=a}for(var d in b)D.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=this.kQuery,q=function(){function b(b,c){this.$el=a(b),this.options=a.extend({},this.defaults,c)}return b.prototype.defaults={},b.prototype.destroy=function(){return this._deinit()},b.prototype._init=function(){return null},b.prototype._deinit=function(){return null},b.register=function(c,d){var e,f,g,h;return h=function(){return"simple_widget_"+d},f=function(b,d){var e,f,g,i,j;for(e=h(),i=0,j=b.length;j>i;i++)f=b[i],g=new c(f,d),a.data(f,e)||a.data(f,e,g),g._init();return b},g=function(c){var d,e,f,g,i,j;for(d=h(),j=[],g=0,i=c.length;i>g;g++)e=c[g],f=a.data(e,d),f&&f instanceof b&&f.destroy(),j.push(a.removeData(e,d));return j},e=function(c,d,e){var f,g,i,j,k,l;for(g=null,k=0,l=c.length;l>k;k++)f=c[k],i=a.data(f,h()),i&&i instanceof b&&(j=i[d],j&&"function"==typeof j&&(g=j.apply(i,e)));return g},a.fn[d]=function(){var a,b,c,d,h;return c=arguments[0],b=2<=arguments.length?C.call(arguments,1):[],a=this,void 0===c||"object"==typeof c?(h=c,f(a,h)):"string"==typeof c&&"_"!==c[0]?(d=c,"destroy"===d?g(a):e(a,d,b)):void 0}},b}(),this.SimpleWidget=q,j=function(b){function c(){return z=c.__super__.constructor.apply(this,arguments)}return E(c,b),c.is_mouse_handled=!1,c.prototype._init=function(){return this.$el.bind("mousedown.mousewidget",a.proxy(this._mouseDown,this)),this.$el.bind("touchstart.mousewidget",a.proxy(this._touchStart,this)),this.is_mouse_started=!1,this.mouse_delay=0,this._mouse_delay_timer=null,this._is_mouse_delay_met=!0,this.mouse_down_info=null},c.prototype._deinit=function(){var b;return this.$el.unbind("mousedown.mousewidget"),this.$el.unbind("touchstart.mousewidget"),b=a(document),b.unbind("mousemove.mousewidget"),b.unbind("mouseup.mousewidget")},c.prototype._mouseDown=function(a){var b;if(1===a.which)return b=this._handleMouseDown(a,this._getPositionInfo(a)),b&&a.preventDefault(),b},c.prototype._handleMouseDown=function(a,b){return!c.is_mouse_handled&&(this.is_mouse_started&&this._handleMouseUp(b),this.mouse_down_info=b,this._mouseCapture(b))?(this._handleStartMouse(),this.is_mouse_handled=!0,!0):void 0},c.prototype._handleStartMouse=function(){var b;return b=a(document),b.bind("mousemove.mousewidget",a.proxy(this._mouseMove,this)),b.bind("touchmove.mousewidget",a.proxy(this._touchMove,this)),b.bind("mouseup.mousewidget",a.proxy(this._mouseUp,this)),b.bind("touchend.mousewidget",a.proxy(this._touchEnd,this)),this.mouse_delay?this._startMouseDelayTimer():void 0},c.prototype._startMouseDelayTimer=function(){var a=this;return this._mouse_delay_timer&&clearTimeout(this._mouse_delay_timer),this._mouse_delay_timer=setTimeout(function(){return a._is_mouse_delay_met=!0},this.mouse_delay),this._is_mouse_delay_met=!1},c.prototype._mouseMove=function(a){return this._handleMouseMove(a,this._getPositionInfo(a))},c.prototype._handleMouseMove=function(a,b){return this.is_mouse_started?(this._mouseDrag(b),a.preventDefault()):this.mouse_delay&&!this._is_mouse_delay_met?!0:(this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==!1,this.is_mouse_started?this._mouseDrag(b):this._handleMouseUp(b),!this.is_mouse_started)},c.prototype._getPositionInfo=function(a){return{page_x:a.pageX,page_y:a.pageY,target:a.target,original_event:a}},c.prototype._mouseUp=function(a){return this._handleMouseUp(this._getPositionInfo(a))},c.prototype._handleMouseUp=function(b){var c;c=a(document),c.unbind("mousemove.mousewidget"),c.unbind("touchmove.mousewidget"),c.unbind("mouseup.mousewidget"),c.unbind("touchend.mousewidget"),this.is_mouse_started&&(this.is_mouse_started=!1,this._mouseStop(b))},c.prototype._mouseCapture=function(a){return!0},c.prototype._mouseStart=function(a){return null},c.prototype._mouseDrag=function(a){return null},c.prototype._mouseStop=function(a){return null},c.prototype.setMouseDelay=function(a){return this.mouse_delay=a},c.prototype._touchStart=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseDown(a,this._getPositionInfo(b))},c.prototype._touchMove=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseMove(a,this._getPositionInfo(b))},c.prototype._touchEnd=function(a){var b;if(!(a.originalEvent.touches.length>1))return b=a.originalEvent.changedTouches[0],this._handleMouseUp(this._getPositionInfo(b))},c}(q),this.Tree={},a=this.kQuery,m={getName:function(a){return m.strings[a-1]},nameToIndex:function(a){var b,c,d;for(b=c=1,d=m.strings.length;d>=1?d>=c:c>=d;b=d>=1?++c:--c)if(m.strings[b-1]===a)return b;return 0}},m.BEFORE=1,m.AFTER=2,m.INSIDE=3,m.NONE=4,m.strings=["before","after","inside","none"],this.Tree.Position=m,k=function(){function b(a,c,d){null==c&&(c=!1),null==d&&(d=b),this.setData(a),this.children=[],this.parent=null,c&&(this.id_mapping={},this.tree=this,this.node_class=d)}return b.prototype.setData=function(a){var b,c,d;if("object"!=typeof a)return this.name=a;d=[];for(b in a)c=a[b],"label"===b?d.push(this.name=c):d.push(this[b]=c);return d},b.prototype.initFromData=function(a){var b,c,d=this;return c=function(a){return d.setData(a),a.children?b(a.children):void 0},b=function(a){var b,c,e,f;for(e=0,f=a.length;f>e;e++)b=a[e],c=new d.tree.node_class(""),c.initFromData(b),d.addChild(c);return null},c(a),null},b.prototype.loadFromData=function(a){var b,c,d,e;for(this.removeChildren(),d=0,e=a.length;e>d;d++)c=a[d],b=new this.tree.node_class(c),this.addChild(b),"object"==typeof c&&c.children&&b.loadFromData(c.children);return null},b.prototype.addChild=function(a){return this.children.push(a),a._setParent(this)},b.prototype.addChildAtPosition=function(a,b){return this.children.splice(b,0,a),a._setParent(this)},b.prototype._setParent=function(a){return this.parent=a,this.tree=a.tree,this.tree.addNodeToIndex(this)},b.prototype.removeChild=function(a){return a.removeChildren(),this._removeChild(a)},b.prototype._removeChild=function(a){return this.children.splice(this.getChildIndex(a),1),this.tree.removeNodeFromIndex(a)},b.prototype.getChildIndex=function(b){return a.inArray(b,this.children)},b.prototype.hasChildren=function(){return 0!==this.children.length},b.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand},b.prototype.iterate=function(a){var b,c=this;return b=function(d,e){var f,g,h,i,j;if(d.children){for(j=d.children,h=0,i=j.length;i>h;h++)f=j[h],g=a(f,e),c.hasChildren()&&g&&b(f,e+1);return null}},b(this,0),null},b.prototype.moveNode=function(a,b,c){return a.isParentOf(b)?void 0:(a.parent._removeChild(a),c===m.AFTER?b.parent.addChildAtPosition(a,b.parent.getChildIndex(b)+1):c===m.BEFORE?b.parent.addChildAtPosition(a,b.parent.getChildIndex(b)):c===m.INSIDE?b.addChildAtPosition(a,0):void 0)},b.prototype.getData=function(){var a;return(a=function(b){var c,d,e,f,g,h,i;for(c=[],h=0,i=b.length;i>h;h++){e=b[h],f={};for(d in e)g=e[d],"parent"!==d&&"children"!==d&&"element"!==d&&"tree"!==d&&Object.prototype.hasOwnProperty.call(e,d)&&(f[d]=g);e.hasChildren()&&(f.children=a(e.children)),c.push(f)}return c})(this.children)},b.prototype.getNodeByName=function(a){var b;return b=null,this.iterate(function(c){return c.name===a?(b=c,!1):!0}),b},b.prototype.addAfter=function(a){var b,c;return this.parent?(c=new this.tree.node_class(a),b=this.parent.getChildIndex(this),this.parent.addChildAtPosition(c,b+1),c):null},b.prototype.addBefore=function(a){var b,c;return this.parent?(c=new this.tree.node_class(a),b=this.parent.getChildIndex(this),this.parent.addChildAtPosition(c,b),c):null},b.prototype.addParent=function(a){var b,c,d,e,f,g;if(this.parent){for(c=new this.tree.node_class(a),c._setParent(this.tree),d=this.parent,g=d.children,e=0,f=g.length;f>e;e++)b=g[e],c.addChild(b);return d.children=[],d.addChild(c),c}return null},b.prototype.remove=function(){return this.parent?(this.parent.removeChild(this),this.parent=null):void 0},b.prototype.append=function(a){var b;return b=new this.tree.node_class(a),this.addChild(b),b},b.prototype.prepend=function(a){var b;return b=new this.tree.node_class(a),this.addChildAtPosition(b,0),b},b.prototype.isParentOf=function(a){var b;for(b=a.parent;b;){if(b===this)return!0;b=b.parent}return!1},b.prototype.getLevel=function(){var a,b;for(a=0,b=this;b.parent;)a+=1,b=b.parent;return a},b.prototype.getNodeById=function(a){return this.id_mapping[a]},b.prototype.addNodeToIndex=function(a){return null!=a.id?this.id_mapping[a.id]=a:void 0},b.prototype.removeNodeFromIndex=function(a){return null!=a.id?delete this.id_mapping[a.id]:void 0},b.prototype.removeChildren=function(){var a=this;return this.iterate(function(b){return a.tree.removeNodeFromIndex(b),!0}),this.children=[]},b.prototype.getPreviousSibling=function(){var a;return this.parent?(a=this.parent.getChildIndex(this)-1,a>=0?this.parent.children[a]:null):null},b.prototype.getNextSibling=function(){var a;return this.parent?(a=this.parent.getChildIndex(this)+1,a<this.parent.children.length?this.parent.children[a]:null):null},b}(),this.Tree.Node=k,h=function(b){function d(){return A=d.__super__.constructor.apply(this,arguments)}return E(d,b),d.prototype.defaults={autoOpen:!1,saveState:!1,dragAndDrop:!1,selectable:!0,useContextMenu:!0,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:!0,dataUrl:null,closedIcon:"&#x25ba;",openedIcon:"&#x25bc;",slide:!0,nodeClass:k,dataFilter:null,keyboardSupport:!0},d.prototype.toggle=function(a,b){return null==b&&(b=!0),a.is_open?this.closeNode(a,b):this.openNode(a,b)},d.prototype.getTree=function(){return this.tree},d.prototype.selectNode=function(a){return this._selectNode(a,!1)},d.prototype._selectNode=function(a,b){var c,d,e,f,g=this;if(null==b&&(b=!1),this.select_node_handler){if(c=function(){return g.options.onCanSelectNode?g.options.selectable&&g.options.onCanSelectNode(a):g.options.selectable},e=function(){var b;return b=a.parent,b&&b.parent&&!b.is_open?g.openNode(b,!1):void 0},f=function(){return g.options.saveState?g.save_state_handler.saveState():void 0},!a)return this._deselectCurrentNode(),void f();if(c())return this.select_node_handler.isNodeSelected(a)?b&&(this._deselectCurrentNode(),this._triggerEvent("tree.select",{node:null,previous_node:a})):(d=this.getSelectedNode(),this._deselectCurrentNode(),this.addToSelection(a),this._triggerEvent("tree.select",{node:a,deselected_node:d}),e()),f()}},d.prototype.getSelectedNode=function(){return this.select_node_handler.getSelectedNode()},d.prototype.toJson=function(){return JSON.stringify(this.tree.getData())},d.prototype.loadData=function(a,b){return this._loadData(a,b)},d.prototype.loadDataFromUrl=function(b,c,d){return"string"!==a.type(b)&&(d=c,c=b,b=null),this._loadDataFromUrl(b,c,d)},d.prototype._loadDataFromUrl=function(b,c,d){var f,g,h,i,j=this;return f=null,g=function(){var a;return c?(a=new e(c,j),f=a.getLi()):f=j.element,f.addClass("jqtree-loading")},i=function(){return f?f.removeClass("jqtree-loading"):void 0},h=function(){return"string"===a.type(b)&&(b={url:b}),b.method?void 0:b.method="get"},g(),b||(b=this._getDataUrlInfo(c)),h(),a.ajax({url:b.url,data:b.data,type:b.method.toUpperCase(),cache:!1,dataType:"json",success:function(b){var e;return e=a.isArray(b)||"object"==typeof b?b:a.parseJSON(b),j.options.dataFilter&&(e=j.options.dataFilter(e)),i(),j._loadData(e,c),d&&a.isFunction(d)?d():void 0},error:function(a){return i(),j.options.onLoadFailed?j.options.onLoadFailed(a):void 0}})},d.prototype._loadData=function(a,b){var c,d,e,f;if(this._triggerEvent("tree.load_data",{tree_data:a}),b){for(d=this.select_node_handler.getSelectedNodes(b),e=0,f=d.length;f>e;e++)c=d[e],this.select_node_handler.removeFromSelection(c);b.loadFromData(a),b.load_on_demand=!1,this._refreshElements(b.parent)}else this._initTree(a);return this.is_dragging?this.dnd_handler.refreshHitAreas():void 0},d.prototype.getNodeById=function(a){return this.tree.getNodeById(a)},d.prototype.getNodeByName=function(a){return this.tree.getNodeByName(a)},d.prototype.openNode=function(a,b){return null==b&&(b=!0),this._openNode(a,b)},d.prototype._openNode=function(a,b,c){var d,f,g=this;if(null==b&&(b=!0),d=function(a,b,c){var d;return d=new e(a,g),d.open(c,b)},a.isFolder()){if(a.load_on_demand)return this._loadFolderOnDemand(a,b,c);for(f=a.parent;f&&!f.is_open;)f.parent&&d(f,!1,null),f=f.parent;return d(a,b,c),this._saveState()}},d.prototype._loadFolderOnDemand=function(a,b,c){var d=this;return null==b&&(b=!0),this._loadDataFromUrl(null,a,function(){return d._openNode(a,b,c)})},d.prototype.closeNode=function(a,b){return null==b&&(b=!0),a.isFolder()?(new e(a,this).close(b),this._saveState()):void 0},d.prototype.isDragging=function(){return this.is_dragging},d.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()},d.prototype.addNodeAfter=function(a,b){var c;return c=b.addAfter(a),this._refreshElements(b.parent),c},d.prototype.addNodeBefore=function(a,b){var c;return c=b.addBefore(a),this._refreshElements(b.parent),c},d.prototype.addParentNode=function(a,b){var c;return c=b.addParent(a),this._refreshElements(c.parent),c},d.prototype.removeNode=function(a){var b;return b=a.parent,b?(this.select_node_handler.removeFromSelection(a,!0),a.remove(),this._refreshElements(b.parent)):void 0},d.prototype.appendNode=function(a,b){var c,d;return b||(b=this.tree),c=b.isFolder(),d=b.append(a),c?this._refreshElements(b):this._refreshElements(b.parent),d},d.prototype.prependNode=function(a,b){var c;return b||(b=this.tree),c=b.prepend(a),this._refreshElements(b),c},d.prototype.updateNode=function(a,b){var c;return c=b.id&&b.id!==a.id,c&&this.tree.removeNodeFromIndex(a),a.setData(b),c&&this.tree.addNodeToIndex(a),this._refreshElements(a.parent),this._selectCurrentNode()},d.prototype.moveNode=function(a,b,c){var d;return d=m.nameToIndex(c),this.tree.moveNode(a,b,d),this._refreshElements()},d.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()},d.prototype.addToSelection=function(a){return this.select_node_handler.addToSelection(a),this._getNodeElementForNode(a).select()},d.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()},d.prototype.isNodeSelected=function(a){return this.select_node_handler.isNodeSelected(a)},d.prototype.removeFromSelection=function(a){return this.select_node_handler.removeFromSelection(a),this._getNodeElementForNode(a).deselect()},d.prototype.scrollToNode=function(b){var c,d;return c=a(b.element),d=c.offset().top-this.$el.offset().top,this.scroll_handler.scrollTo(d)},d.prototype.getState=function(){return this.save_state_handler.getState()},d.prototype.setState=function(a){return this.save_state_handler.setState(a),this._refreshElements()},d.prototype._init=function(){return d.__super__._init.call(this),this.element=this.$el,this.mouse_delay=300,this.is_initialized=!1,"undefined"!=typeof n&&null!==n?this.save_state_handler=new n(this):this.options.saveState=!1,"undefined"!=typeof p&&null!==p&&(this.select_node_handler=new p(this)),"undefined"!=typeof c&&null!==c?this.dnd_handler=new c(this):this.options.dragAndDrop=!1,"undefined"!=typeof o&&null!==o&&(this.scroll_handler=new o(this)),"undefined"!=typeof i&&null!==i&&"undefined"!=typeof p&&null!==p&&(this.key_handler=new i(this)),this._initData(),this.element.click(a.proxy(this._click,this)),this.element.dblclick(a.proxy(this._dblclick,this)),this.options.useContextMenu?this.element.bind("contextmenu",a.proxy(this._contextmenu,this)):void 0},d.prototype._deinit=function(){return this.element.empty(),this.element.unbind(),this.key_handler.deinit(),this.tree=null,d.__super__._deinit.call(this)},d.prototype._initData=function(){return this.options.data?this._loadData(this.options.data):this._loadDataFromUrl(this._getDataUrlInfo())},d.prototype._getDataUrlInfo=function(b){var c,d,e=this;return c=this.options.dataUrl||this.element.data("url"),d=function(){var a,d,f;return f={url:c},b&&b.id?(a={node:b.id},f.data=a):(d=e._getNodeIdToBeSelected(),d&&(a={selected_node:d},f.data=a)),f},a.isFunction(c)?c(b):"string"===a.type(c)?d():c},d.prototype._getNodeIdToBeSelected=function(){return this.options.saveState?this.save_state_handler.getNodeIdToBeSelected():null},d.prototype._initTree=function(a){return this.tree=new this.options.nodeClass(null,!0,this.options.nodeClass),this.select_node_handler&&this.select_node_handler.clear(),this.tree.loadFromData(a),this._openNodes(),this._refreshElements(),this.is_initialized?void 0:(this.is_initialized=!0,this._triggerEvent("tree.init"))},d.prototype._openNodes=function(){var a;if(!(this.options.saveState&&this.save_state_handler.restoreState()||this.options.autoOpen===!1))return a=this.options.autoOpen===!0?-1:parseInt(this.options.autoOpen),this.tree.iterate(function(b,c){return b.hasChildren()&&(b.is_open=!0),c!==a})},d.prototype._refreshElements=function(b){var c,d,e,f,g,h,i,j,k,l=this;return null==b&&(b=null),i=function(a){return l.options.autoEscape?s(a):a},g=function(b){var c;return c=b?"jqtree-tree":"",a('<ul class="jqtree_common '+c+'"></ul>')},e=function(a){var b;return b=a.isFolder()?d(a):f(a),l.options.onCreateLi&&l.options.onCreateLi(a,b),b},f=function(b){var c,d,e;return e=["jqtree_common"],l.select_node_handler&&l.select_node_handler.isNodeSelected(b)&&e.push("jqtree-selected"),c=e.join(" "),d=i(b.name),a('<li class="'+c+'"><div class="jqtree-element jqtree_common"><span class="jqtree-title jqtree_common">'+d+"</span></div></li>")},d=function(b){var c,d,e,f,g,h;return g=function(){var a;return a=["jqtree-toggler"],b.is_open||a.push("jqtree-closed"),a.join(" ")},h=function(){var a;return a=["jqtree-folder"],b.is_open||a.push("jqtree-closed"),l.select_node_handler&&l.select_node_handler.isNodeSelected(b)&&a.push("jqtree-selected"),a.join(" ")},d=g(),f=h(),e=i(b.name),c=b.is_open?l.options.openedIcon:l.options.closedIcon,a('<li class="jqtree_common '+f+'"><div class="jqtree-element jqtree_common"><a class="jqtree_common '+d+'">'+c+'</a><span class="jqtree_common jqtree-title">'+e+"</span></div></li>")},h=function(a,b,c,d){var f,i,j,k,l;for(i=g(c),a.append(i),k=0,l=b.length;l>k;k++)j=b[k],f=e(j),i.append(f),j.element=f[0],f.data("node",j),j.hasChildren()&&h(f,j.children,!1,j.is_open);return null},b&&b.parent?(j=!1,k=this._getNodeElementForNode(b),k.getUl().remove(),c=k.$element):(b=this.tree,c=this.element,c.empty(),j=!0),h(c,b.children,j,j),this._triggerEvent("tree.refresh")},d.prototype._click=function(a){var b,c,d;if(b=this._getClickTarget(a.target)){if("button"===b.type)return this.toggle(b.node,this.options.slide),a.preventDefault(),a.stopPropagation();if("label"===b.type&&(d=b.node,c=this._triggerEvent("tree.click",{node:d}),!c.isDefaultPrevented()))return this._selectNode(d,!0)}},d.prototype._dblclick=function(a){var b;return b=this._getClickTarget(a.target),b&&"label"===b.type?this._triggerEvent("tree.dblclick",{node:b.node}):void 0},d.prototype._getClickTarget=function(b){var c,d,e,f;if(e=a(b),c=e.closest(".jqtree-toggler"),c.length){if(f=this._getNode(c))return{type:"button",node:f}}else if(d=e.closest(".jqtree-element"),d.length&&(f=this._getNode(d)))return{type:"label",node:f};return null},d.prototype._getNode=function(a){var b;return b=a.closest("li"),0===b.length?null:b.data("node")},d.prototype._getNodeElementForNode=function(a){return a.isFolder()?new e(a,this):new l(a,this)},d.prototype._getNodeElement=function(a){var b;return b=this._getNode(a),b?this._getNodeElementForNode(b):null},d.prototype._contextmenu=function(b){var c,d;return c=a(b.target).closest("ul.jqtree-tree .jqtree-element"),c.length&&(d=this._getNode(c))?(b.preventDefault(),b.stopPropagation(),this._triggerEvent("tree.contextmenu",{node:d,click_event:b}),!1):void 0},d.prototype._saveState=function(){return this.options.saveState?this.save_state_handler.saveState():void 0},d.prototype._mouseCapture=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseCapture(a):!1},d.prototype._mouseStart=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseStart(a):!1},d.prototype._mouseDrag=function(a){var b;return this.options.dragAndDrop?(b=this.dnd_handler.mouseDrag(a),this.scroll_handler&&this.scroll_handler.checkScrolling(),b):!1},d.prototype._mouseStop=function(a){return this.options.dragAndDrop?this.dnd_handler.mouseStop(a):!1},d.prototype._triggerEvent=function(b,c){var d;return d=a.Event(b),a.extend(d,c),this.element.trigger(d),d},d.prototype.testGenerateHitAreas=function(a){return this.dnd_handler.current_item=this._getNodeElementForNode(a),this.dnd_handler.generateHitAreas(),this.dnd_handler.hit_areas},d.prototype._selectCurrentNode=function(){var a,b;return a=this.getSelectedNode(),a&&(b=this._getNodeElementForNode(a))?b.select():void 0},d.prototype._deselectCurrentNode=function(){var a;return a=this.getSelectedNode(),a?this.removeFromSelection(a):void 0},d}(j),q.register(h,"tree"),l=function(){function c(a,b){this.init(a,b)}return c.prototype.init=function(b,c){return this.node=b,this.tree_widget=c,this.$element=a(b.element)},c.prototype.getUl=function(){return this.$element.children("ul:first")},c.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")},c.prototype.getLi=function(){return this.$element},c.prototype.addDropHint=function(a){return a===m.INSIDE?new b(this.$element):new f(this.node,this.$element,a)},c.prototype.select=function(){return this.getLi().addClass("jqtree-selected")},c.prototype.deselect=function(){return this.getLi().removeClass("jqtree-selected")},c}(),e=function(a){function c(){return B=c.__super__.constructor.apply(this,arguments)}return E(c,a),c.prototype.open=function(a,b){var c,d,e=this;return null==b&&(b=!0),this.node.is_open?void 0:(this.node.is_open=!0,c=this.getButton(),c.removeClass("jqtree-closed"),c.html(this.tree_widget.options.openedIcon),d=function(){return e.getLi().removeClass("jqtree-closed"),a&&a(),e.tree_widget._triggerEvent("tree.open",{node:e.node})},b?this.getUl().slideDown("fast",d):(this.getUl().show(),d()))},c.prototype.close=function(a){var b,c,d=this;return null==a&&(a=!0),this.node.is_open?(this.node.is_open=!1,b=this.getButton(),b.addClass("jqtree-closed"),b.html(this.tree_widget.options.closedIcon),c=function(){return d.getLi().addClass("jqtree-closed"),d.tree_widget._triggerEvent("tree.close",{node:d.node})},a?this.getUl().slideUp("fast",c):(this.getUl().hide(),c())):void 0},c.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")},c.prototype.addDropHint=function(a){return this.node.is_open||a!==m.INSIDE?new f(this.node,this.$element,a):new b(this.$element)},c}(l),s=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},y=function(a,b){var c,d,e,f;for(c=e=0,f=a.length;f>e;c=++e)if(d=a[c],d===b)return c;return-1},t=function(a,b){return a.indexOf?a.indexOf(b):y(a,b)},this.Tree.indexOf=t,this.Tree._indexOf=y,(null==this.JSON||null==this.JSON.stringify||"function"!=typeof this.JSON.stringify)&&(u=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,v={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},w=function(a){return u.lastIndex=0,u.test(a)?'"'+a.replace(u,function(a){var b;return b=v[a],"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},x=function(a,b){var c,d,e,f,g,h,i;switch(g=b[a],typeof g){case"string":return w(g);case"number":return isFinite(g)?String(g):"null";case"boolean":case"null":return String(g);case"object":if(!g)return"null";if(e=[],"[object Array]"===Object.prototype.toString.apply(g)){for(c=h=0,i=g.length;i>h;c=++h)f=g[c],e[c]=x(c,g)||"null";return 0===e.length?"[]":"["+e.join(",")+"]"}for(d in g)Object.prototype.hasOwnProperty.call(g,d)&&(f=x(d,g),f&&e.push(w(d)+":"+f));return 0===e.length?"{}":"{"+e.join(",")+"}"}},null==this.JSON&&(this.JSON={}),this.JSON.stringify=function(a){return x("",{"":a})}),n=function(){function b(a){this.tree_widget=a}return b.prototype.saveState=function(){var b;return b=JSON.stringify(this.getState()),this.tree_widget.options.onSetStateFromStorage?this.tree_widget.options.onSetStateFromStorage(b):this.supportsLocalStorage()?localStorage.setItem(this.getCookieName(),b):a.cookie?(a.cookie.raw=!0,a.cookie(this.getCookieName(),b,{path:"/"})):void 0},b.prototype.restoreState=function(){var b;return b=this.getStateFromStorage(),b?(this.setState(a.parseJSON(b)),!0):!1},b.prototype.getStateFromStorage=function(){return this.tree_widget.options.onGetStateFromStorage?this.tree_widget.options.onGetStateFromStorage():this.supportsLocalStorage()?localStorage.getItem(this.getCookieName()):a.cookie?(a.cookie.raw=!0,a.cookie(this.getCookieName())):null},b.prototype.getState=function(){var a,b,c;return a=[],this.tree_widget.tree.iterate(function(b){return b.is_open&&b.id&&b.hasChildren()&&a.push(b.id),!0}),b=this.tree_widget.getSelectedNode(),c=b?b.id:"",{open_nodes:a,selected_node:c}},b.prototype.setState=function(a){var b,c,d;return a&&(b=a.open_nodes,d=a.selected_node,this.tree_widget.tree.iterate(function(a){return a.is_open=a.id&&a.hasChildren()&&t(b,a.id)>=0,!0}),d&&this.tree_widget.select_node_handler&&(this.tree_widget.select_node_handler.clear(),c=this.tree_widget.getNodeById(d)))?this.tree_widget.select_node_handler.addToSelection(c):void 0},b.prototype.getCookieName=function(){return"string"==typeof this.tree_widget.options.saveState?this.tree_widget.options.saveState:"tree"},b.prototype.supportsLocalStorage=function(){var a;return a=function(){var a,b;if("undefined"==typeof localStorage||null===localStorage)return!1;try{b="_storage_test",sessionStorage.setItem(b,!0),sessionStorage.removeItem(b)}catch(c){return a=c,!1}return!0},null==this._supportsLocalStorage&&(this._supportsLocalStorage=a()),this._supportsLocalStorage},b.prototype.getNodeIdToBeSelected=function(){var b,c;return c=this.getStateFromStorage(),c?(b=a.parseJSON(c),b.selected_node):null},b}(),p=function(){function a(a){this.tree_widget=a,this.clear()}return a.prototype.getSelectedNode=function(){var a;return a=this.getSelectedNodes(),a.length?a[0]:!1},a.prototype.getSelectedNodes=function(){var a,b,c;if(this.selected_single_node)return[this.selected_single_node];c=[];for(a in this.selected_nodes)b=this.tree_widget.getNodeById(a),b&&c.push(b);return c},a.prototype.isNodeSelected=function(a){return a.id?this.selected_nodes[a.id]:this.selected_single_node?this.selected_single_node.element===a.element:!1},a.prototype.clear=function(){return this.selected_nodes={},this.selected_single_node=null},a.prototype.removeFromSelection=function(a,b){var c=this;if(null==b&&(b=!1),a.id){if(delete this.selected_nodes[a.id],b)return a.iterate(function(b){return delete c.selected_nodes[a.id],!0})}else if(a.element===this.selected_single_node.element)return this.selected_single_node=null},a.prototype.addToSelection=function(a){return a.id?this.selected_nodes[a.id]=!0:this.selected_single_node=a},a}(),c=function(){function b(a){this.tree_widget=a,this.hovered_area=null,this.$ghost=null,this.hit_areas=[],this.is_dragging=!1}return b.prototype.mouseCapture=function(b){var c,d;return c=a(b.target),this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(c)?null:(d=this.tree_widget._getNodeElement(c),d&&this.tree_widget.options.onCanMove&&(this.tree_widget.options.onCanMove(d.node)||(d=null)),this.current_item=d,null!==this.current_item)},b.prototype.mouseStart=function(b){var c;return this.refreshHitAreas(),c=a(b.target).offset(),this.drag_element=new d(this.current_item.node,b.page_x-c.left,b.page_y-c.top,this.tree_widget.element),this.is_dragging=!0,this.current_item.$element.addClass("jqtree-moving"),!0},b.prototype.mouseDrag=function(a){var b,c;return this.drag_element.move(a.page_x,a.page_y),b=this.findHoveredArea(a.page_x,a.page_y),c=this.canMoveToArea(b),b?this.hovered_area!==b&&(this.hovered_area=b,this.mustOpenFolderTimer(b)&&this.startOpenFolderTimer(b.node),c&&this.updateDropHint()):(this.removeHover(),this.removeDropHint(),this.stopOpenFolderTimer()),!0},b.prototype.canMoveToArea=function(a){var b;return a?this.tree_widget.options.onCanMoveTo?(b=m.getName(a.position),this.tree_widget.options.onCanMoveTo(this.current_item.node,a.node,b)):!0:!1},b.prototype.mouseStop=function(a){return this.moveItem(a),this.clear(),this.removeHover(),this.removeDropHint(),this.removeHitAreas(),this.current_item&&this.current_item.$element.removeClass("jqtree-moving"),this.is_dragging=!1,!1},b.prototype.refreshHitAreas=function(){return this.removeHitAreas(),this.generateHitAreas()},b.prototype.removeHitAreas=function(){return this.hit_areas=[]},b.prototype.clear=function(){return this.drag_element.remove(),this.drag_element=null},b.prototype.removeDropHint=function(){return this.previous_ghost?this.previous_ghost.remove():void 0},b.prototype.removeHover=function(){return this.hovered_area=null},b.prototype.generateHitAreas=function(){var a;return a=new g(this.tree_widget.tree,this.current_item.node,this.getTreeDimensions().bottom),this.hit_areas=a.generate()},b.prototype.findHoveredArea=function(a,b){var c,d,e,f,g;if(d=this.getTreeDimensions(),a<d.left||b<d.top||a>d.right||b>d.bottom)return null;for(f=0,e=this.hit_areas.length;e>f;)if(g=f+e>>1,c=this.hit_areas[g],b<c.top)e=g;else{if(!(b>c.bottom))return c;f=g+1}return null},b.prototype.mustOpenFolderTimer=function(a){var b;return b=a.node,b.isFolder()&&!b.is_open&&a.position===m.INSIDE},b.prototype.updateDropHint=function(){var a;if(this.hovered_area)return this.removeDropHint(),a=this.tree_widget._getNodeElementForNode(this.hovered_area.node),this.previous_ghost=a.addDropHint(this.hovered_area.position)},b.prototype.startOpenFolderTimer=function(a){var b,c=this;return b=function(){return c.tree_widget._openNode(a,c.tree_widget.options.slide,function(){return c.refreshHitAreas(),c.updateDropHint()})},this.open_folder_timer=setTimeout(b,500)},b.prototype.stopOpenFolderTimer=function(){return this.open_folder_timer?(clearTimeout(this.open_folder_timer),this.open_folder_timer=null):void 0},b.prototype.moveItem=function(a){var b,c,d,e,f,g,h=this;return this.hovered_area&&this.hovered_area.position!==m.NONE&&this.canMoveToArea(this.hovered_area)&&(d=this.current_item.node,g=this.hovered_area.node,e=this.hovered_area.position,f=d.parent,e===m.INSIDE&&(this.hovered_area.node.is_open=!0),b=function(){return h.tree_widget.tree.moveNode(d,g,e),h.tree_widget.element.empty(),h.tree_widget._refreshElements()},c=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:d,target_node:g,position:m.getName(e),previous_parent:f,do_move:b,original_event:a.original_event}}),!c.isDefaultPrevented())?b():void 0},b.prototype.getTreeDimensions=function(){var a;return a=this.tree_widget.element.offset(),{left:a.left,top:a.top,right:a.left+this.tree_widget.element.width(),bottom:a.top+this.tree_widget.element.height()+16}},b}(),r=function(){function b(a){this.tree=a}return b.prototype.iterate=function(){var b,c,d=this;return b=!0,(c=function(e,f){var g,h,i,j,k,l,m,n;if(k=(e.is_open||!e.element)&&e.hasChildren(),e.element){if(g=a(e.element),!g.is(":visible"))return;b&&(d.handleFirstNode(e,g),b=!1),e.hasChildren()?e.is_open?d.handleOpenFolder(e,g)||(k=!1):d.handleClosedFolder(e,f,g):d.handleNode(e,f,g)}if(k){for(i=e.children.length,n=e.children,j=l=0,m=n.length;m>l;j=++l)h=n[j],j===i-1?c(e.children[j],null):c(e.children[j],e.children[j+1]);if(e.is_open)return d.handleAfterOpenFolder(e,f,g)}})(this.tree,null)},b.prototype.handleNode=function(a,b,c){},b.prototype.handleOpenFolder=function(a,b){},b.prototype.handleClosedFolder=function(a,b,c){},
b.prototype.handleAfterOpenFolder=function(a,b,c){},b.prototype.handleFirstNode=function(a,b){},b}(),g=function(b){function c(a,b,d){c.__super__.constructor.call(this,a),this.current_node=b,this.tree_bottom=d}return E(c,b),c.prototype.generate=function(){return this.positions=[],this.last_top=0,this.iterate(),this.generateHitAreas(this.positions)},c.prototype.getTop=function(a){return a.offset().top},c.prototype.addPosition=function(a,b,c){return this.positions.push({top:c,node:a,position:b}),this.last_top=c},c.prototype.handleNode=function(a,b,c){var d;return d=this.getTop(c),a===this.current_node?this.addPosition(a,m.NONE,d):this.addPosition(a,m.INSIDE,d),b===this.current_node||a===this.current_node?this.addPosition(a,m.NONE,d):this.addPosition(a,m.AFTER,d)},c.prototype.handleOpenFolder=function(a,b){return a===this.current_node?!1:(a.children[0]!==this.current_node&&this.addPosition(a,m.INSIDE,this.getTop(b)),!0)},c.prototype.handleClosedFolder=function(a,b,c){var d;return d=this.getTop(c),a===this.current_node?this.addPosition(a,m.NONE,d):(this.addPosition(a,m.INSIDE,d),b!==this.current_node?this.addPosition(a,m.AFTER,d):void 0)},c.prototype.handleAfterOpenFolder=function(a,b,c){return a===this.current_node||b===this.current_node?this.addPosition(a,m.NONE,this.last_top):this.addPosition(a,m.AFTER,this.last_top)},c.prototype.handleFirstNode=function(b,c){return b!==this.current_node?this.addPosition(b,m.BEFORE,this.getTop(a(b.element))):void 0},c.prototype.generateHitAreas=function(a){var b,c,d,e,f,g;for(e=-1,b=[],c=[],f=0,g=a.length;g>f;f++)d=a[f],d.top!==e&&b.length&&(b.length&&this.generateHitAreasForGroup(c,b,e,d.top),e=d.top,b=[]),b.push(d);return this.generateHitAreasForGroup(c,b,e,this.tree_bottom),c},c.prototype.generateHitAreasForGroup=function(a,b,c,d){var e,f,g,h,i;for(e=(d-c)/b.length,f=c,h=0,i=b.length;i>h;h++)g=b[h],a.push({top:f,bottom:f+e,node:g.node,position:g.position}),f+=e;return null},c}(r),d=function(){function b(b,c,d,e){this.offset_x=c,this.offset_y=d,this.$element=a('<span class="jqtree-title jqtree-dragging">'+b.name+"</span>"),this.$element.css("position","absolute"),e.append(this.$element)}return b.prototype.move=function(a,b){return this.$element.offset({left:a-this.offset_x,top:b-this.offset_y})},b.prototype.remove=function(){return this.$element.remove()},b}(),f=function(){function b(b,c,d){this.$element=c,this.node=b,this.$ghost=a('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>'),d===m.AFTER?this.moveAfter():d===m.BEFORE?this.moveBefore():d===m.INSIDE&&(b.isFolder()&&b.is_open?this.moveInsideOpenFolder():this.moveInside())}return b.prototype.remove=function(){return this.$ghost.remove()},b.prototype.moveAfter=function(){return this.$element.after(this.$ghost)},b.prototype.moveBefore=function(){return this.$element.before(this.$ghost)},b.prototype.moveInsideOpenFolder=function(){return a(this.node.children[0].element).before(this.$ghost)},b.prototype.moveInside=function(){return this.$element.after(this.$ghost),this.$ghost.addClass("jqtree-inside")},b}(),b=function(){function b(b){var c,d;c=b.children(".jqtree-element"),d=b.width()-4,this.$hint=a('<span class="jqtree-border"></span>'),c.append(this.$hint),this.$hint.css({width:d,height:c.height()-4})}return b.prototype.remove=function(){return this.$hint.remove()},b}(),o=function(){function b(a){this.tree_widget=a,this.previous_top=-1,this._initScrollParent()}return b.prototype._initScrollParent=function(){var b,c,d,e=this;return c=function(){var b,c,d,f,g,h,i,j,k,l;for(c=["overflow","overflow-y"],f=null,k=e.tree_widget.$el.parents(),g=0,i=k.length;i>g;g++)for(d=k[g],h=0,j=c.length;j>h;h++)if(b=c[h],"auto"===(l=a.css(d,b))||"scroll"===l)return a(d);return null},d=function(){return e.scroll_parent_top=0,e.$scroll_parent=null},"fixed"===this.tree_widget.$el.css("position")&&d(),b=c(),b&&b.length&&"HTML"!==b[0].tagName?(this.$scroll_parent=b,this.scroll_parent_top=this.$scroll_parent.offset().top):d()},b.prototype.checkScrolling=function(){var a;return a=this.tree_widget.dnd_handler.hovered_area,a&&a.top!==this.previous_top?(this.previous_top=a.top,this.$scroll_parent?this._handleScrollingWithScrollParent(a):this._handleScrollingWithDocument(a)):void 0},b.prototype._handleScrollingWithScrollParent=function(a){var b;return b=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-a.bottom,20>b?(this.$scroll_parent[0].scrollTop+=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1):a.top-this.scroll_parent_top<20?(this.$scroll_parent[0].scrollTop-=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1):void 0},b.prototype._handleScrollingWithDocument=function(b){var c;return c=b.top-a(document).scrollTop(),20>c?a(document).scrollTop(a(document).scrollTop()-20):a(window).height()-(b.bottom-a(document).scrollTop())<20?a(document).scrollTop(a(document).scrollTop()+20):void 0},b.prototype.scrollTo=function(b){var c;return this.$scroll_parent?this.$scroll_parent[0].scrollTop=b:(c=this.tree_widget.$el.offset().top,a(document).scrollTop(b+c))},b.prototype.isScrolledIntoView=function(b){var c,d,e,f,g;return c=a(b),this.$scroll_parent?(g=0,f=this.$scroll_parent.height(),e=c.offset().top-this.scroll_parent_top,d=e+c.height()):(g=a(window).scrollTop(),f=g+a(window).height(),e=c.offset().top,d=e+c.height()),f>=d&&e>=g},b}(),i=function(){function b(b){this.tree_widget=b,b.options.keyboardSupport&&a(document).bind("keydown.jqtree",a.proxy(this.handleKeyDown,this))}var c,d,e,f;return d=37,f=38,e=39,c=40,b.prototype.deinit=function(){return a(document).unbind("keydown.jqtree")},b.prototype.handleKeyDown=function(b){var g,h,i,j,k,l,m,n=this;if(a(document.activeElement).is("textarea,input"))return!0;if(g=this.tree_widget.getSelectedNode(),m=function(b){return b?(n.tree_widget.selectNode(b),n.tree_widget.scroll_handler&&!n.tree_widget.scroll_handler.isScrolledIntoView(a(b.element).find(".jqtree-element"))&&n.tree_widget.scrollToNode(b),!1):!0},i=function(){return m(n.getNextNode(g))},l=function(){return m(n.getPreviousNode(g))},k=function(){return g.hasChildren()&&!g.is_open?(n.tree_widget.openNode(g),!1):!0},j=function(){return g.hasChildren()&&g.is_open?(n.tree_widget.closeNode(g),!1):!0},!g)return!0;switch(h=b.which){case c:return i();case f:return l();case e:return k();case d:return j()}},b.prototype.getNextNode=function(a,b){var c;return null==b&&(b=!0),b&&a.hasChildren()&&a.is_open?a.children[0]:a.parent?(c=a.getNextSibling(),c?c:this.getNextNode(a.parent,!1)):null},b.prototype.getPreviousNode=function(a){var b;return a.parent?(b=a.getPreviousSibling(),b?b.hasChildren()&&b.is_open?this.getLastChild(b):b:a.parent.parent?a.parent:null):null},b.prototype.getLastChild=function(a){var b;return a.hasChildren()?(b=a.children[a.children.length-1],b.hasChildren()&&b.is_open?this.getLastChild(b):b):null},b}()}).call(this);
//# sourceMappingURL=jqtree.js.map