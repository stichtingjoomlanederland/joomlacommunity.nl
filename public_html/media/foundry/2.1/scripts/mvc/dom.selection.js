!function(){var moduleFactory=function($){var module=this;$.require().script("mvc/dom.range").done(function(){var exports=function(){var getWindow=function(element){return element?element.ownerDocument.defaultView||element.ownerDocument.parentWindow:window},getElementsSelection=function(el){var current=$.Range.current(el).clone(),entireElement=$.Range(el).select(el);return current.overlaps(entireElement)?(current.compare("START_TO_START",entireElement)<1?(startPos=0,current.move("START_TO_START",entireElement)):(fromElementToCurrent=entireElement.clone(),fromElementToCurrent.move("END_TO_START",current),startPos=fromElementToCurrent.toString().length),endPos=current.compare("END_TO_END",entireElement)>=0?entireElement.toString().length:startPos+current.toString().length,{start:startPos,end:endPos}):null
},getSelection=function(el){var win=getWindow(el);if(void 0!==el.selectionStart)return document.activeElement&&document.activeElement!=el&&el.selectionStart==el.selectionEnd&&0==el.selectionStart?{start:el.value.length,end:el.value.length}:{start:el.selectionStart,end:el.selectionEnd};if(win.getSelection)return getElementsSelection(el,win);try{if("input"==el.nodeName.toLowerCase()){var real=getWindow(el).document.selection.createRange(),r=el.createTextRange();r.setEndPoint("EndToStart",real);var start=r.text.length;
return{start:start,end:start+real.text.length}}var res=getElementsSelection(el,win);if(!res)return res;var current=$.Range.current().clone(),r2=current.clone().collapse().range,r3=current.clone().collapse(!1).range;return r2.moveStart("character",-1),r3.moveStart("character",-1),0!=res.startPos&&""==r2.text&&(res.startPos+=2),0!=res.endPos&&""==r3.text&&(res.endPos+=2),res}catch(e){return{start:el.value.length,end:el.value.length}}},select=function(el,start,end){var win=getWindow(el);if(el.setSelectionRange)void 0===end?(el.focus(),el.setSelectionRange(start,start)):(el.select(),el.selectionStart=start,el.selectionEnd=end);
else if(el.createTextRange){var r=el.createTextRange();r.moveStart("character",start),end=end||start,r.moveEnd("character",end-el.value.length),r.select()}else if(win.getSelection){var doc=win.document,sel=win.getSelection(),range=doc.createRange(),ranges=[start,void 0!==end?end:start];getCharElement([el],ranges),range.setStart(ranges[0].el,ranges[0].count),range.setEnd(ranges[1].el,ranges[1].count),sel.removeAllRanges(),sel.addRange(range)}else if(win.document.body.createTextRange){var range=document.body.createTextRange();
range.moveToElementText(el),range.collapse(),range.moveStart("character",start),range.moveEnd("character",void 0!==end?end:start),range.select()}},replaceWithLess=function(start,len,range,el){"number"==typeof range[0]&&range[0]<len&&(range[0]={el:el,count:range[0]-start}),"number"==typeof range[1]&&range[1]<=len&&(range[1]={el:el,count:range[1]-start})},getCharElement=function(elems,range,len){var elem,start;len=len||0;for(var i=0;elems[i];i++)elem=elems[i],3===elem.nodeType||4===elem.nodeType?(start=len,len+=elem.nodeValue.length,replaceWithLess(start,len,range,elem)):8!==elem.nodeType&&(len=getCharElement(elem.childNodes,range,len));
return len};$.fn.selection=function(start,end){return void 0!==start?this.each(function(){select(this,start,end)}):getSelection(this[0])},$.fn.selection.getCharElement=getCharElement};exports(),module.resolveWith(exports)})};dispatch("mvc/dom.selection").containing(moduleFactory).to("Foundry/2.1 Modules")}();