jQuery(document).ready(function(_){var e,a,t,i,c,s,r,l=0,m=0,o=0,n=0,h=500,u=10,g=0,d=0,y=0;function k(){var e=_("#acym__migrate__mails").is(":checked");e?_("#acym__migrate__input__global_stats").show():_("#acym__migrate__input__global_stats").hide(),_("#acym__migrate__mailstats").prop("disabled",0==e),_("#acym__migrate__button").prop("disabled",0==_("input:checked").length)}function f(){_("#acym__migrate__no__button").prop("disabled",!0),_("#acym__migrate__button").prop("disabled",!0),_(".acym__migrate__option").prop("disabled",!0);var e={config:_("#acym__migrate__config").is(":checked")&&!_("#acym__migrate__config").hasClass("acym__migrate__migrate_with_success_element"),bounce:_("#acym__migrate__bounce").is(":checked")&&!_("#acym__migrate__bounce").hasClass("acym__migrate__migrate_with_success_element"),lists:_("#acym__migrate__lists").is(":checked")&&!_("#acym__migrate__lists").hasClass("acym__migrate__migrate_with_success_element"),mails:_("#acym__migrate__mails").is(":checked")&&!_("#acym__migrate__mails").hasClass("acym__migrate__migrate_with_success_element"),templates:_("#acym__migrate__templates").is(":checked")&&!_("#acym__migrate__templates").hasClass("acym__migrate__migrate_with_success_element"),fields:_("#acym__migrate__fields").is(":checked")&&!_("#acym__migrate__fields").hasClass("acym__migrate__migrate_with_success_element"),users:_("#acym__migrate__users").is(":checked")&&!_("#acym__migrate__users").hasClass("acym__migrate__migrate_with_success_element")};e.subscriptions=e.users&&e.lists,e.users_fields=e.users&&e.fields,e.mailstats=_("#acym__migrate__mailstats").is(":checked")&&!_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),e.mailhaslists=e.mails&&e.lists,e.welcomeunsub=e.mails&&e.lists;var a=[],t=[];e.mails,_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),e.mails&&e.lists,e.lists;_.each(e,function(_,e){if(!0===e){var i=ACYM_AJAX_URL+"&ctrl=dashboard&task=preMigration&element="+_;a.push(i),t.push(_)}}),_("#acym__migrate__all_checked_elements").val(JSON.stringify(t)),g=t.length,d=100/g,_(".acym__migration__need__display").show(),p(a,t)}function w(e,a,t,i,c){e?(_("#acym__migrate__error_element").val(a),_("#acym__migrate__result__"+a+"__check").html('<i class="acymicon-exclamation-circle acym__color__red"></i>'),"mails"==a&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="acymicon-exclamation-circle acym__color__red"></i>'),_("#acym__migrate__result__error__message").html(c),_("#acym__migrate__result__error").show()):(_("#acym__migrate__result__"+a+"__check").html('<i class="acymicon-check-circle acym__color__green"></i>'),"mails"==a&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="acymicon-check-circle acym__color__green"></i>'),_("#acym__migrate__"+a).addClass("acym__migrate__migrate_with_success_element"),p(t,i))}function p(e,a){if(0==e.length)return _("#acym__migration__progress__bar__inner").animate({width:"100%"}),_("#acym__migration__percentage").html("100%"),void _("#acym__migrate__result__ok").show();var t=a.shift().toLowerCase();_("#acym__migrate__result__"+t+"__check").html('<i class="acymicon-circle-o-notch acymicon-spin acym__color__blue"></i>');var i=e.shift();_.post(i,function(i){if("0"==i)y+=d,_("#acym__migration__progress__bar__inner").animate({width:Math.round(y)+"%"}),_("#acym__migration__percentage").html(Math.round(y)+"%"),w(!1,t,e,a,i);else if(-1!==i.indexOf("ERROR"))w(!0,t,e,a,i);else{m=0,n=0,l=Math.ceil(i/(h*u)),o=Math.ceil(i/h);!function e(a,t,i){for(var c=!1,s=[],r="",g=0;g<u&&!(n>o);g++){var k=n*h,f=_.post(ACYM_AJAX_URL+"&ctrl=dashboard&task=migrate&element="+a+"&currentElement="+k+"&insertPerCalls="+h);s.push(f),n++}return _.when.apply(_,s).then(function(){m++,y=d/l+y,_("#acym__migration__progress__bar__inner").animate({width:Math.round(y)+"%"}),_("#acym__migration__percentage").html(Math.round(y)+"%"),_.each(arguments,function(_,e){-1!==e[0].indexOf("ERROR")&&(c=!0,r=e[0],w(c,a,t,i,r))}),m===l?w(c,a,t,i,r):e(a,t,i)}),!0}(t,e,a)}}).fail(function(e){_("#acym__migrate__result").append("<br>"+ACYM_JS_TXT.ACYM_LOADING_ERROR)})}function v(){_(".acym__walkthrough__list__receivers__remove").off("click").on("click",function(){_(this).closest("tr").remove()})}_(".acym__walk-through__select").select2({theme:"foundation",width:"100%"}),function e(){_(".acym__dashboard__active-campaigns__one-campaign__action").off("click").on("click",function(){var a=ACYM_AJAX_URL+"&ctrl=campaigns&task=cancelDashboardAndGetCampaignsAjax&id="+_(this).attr("id");_.post(a,function(a){"error"==a?console.log(a):_(".acym__dashboard__active-campaigns__listing").html(a),e()})})}(),_("#acym__walk-through-1__content__toggle-reply-to__checkbox").off("change").on("change",function(){_(".acym__walk-through-1__content__reply-to").toggle()}),e=_(".acym__walk-through-2__choose_your-server"),a=_(".acym__walk-through-2__choose_external-server"),t=_(".acym__walk-through-2__smtp-server"),i=_(".acym__walk-through-2__elastic-email"),c=_(".acym__walk-through-2__toggle-mail .acym__walk_through_toggle-span"),s=_(".acym__walk-through-2__choose_external-server .acym__walk_through_toggle-span"),c.off("click").on("click",function(){c.removeClass("walk-through_selected"),_(this).addClass("walk-through_selected"),"your-server"==_(this).attr("id")?e.show()&&a.hide()&&_("#acym__walk-through-2__way-mail").val(_(".your_server_selected").attr("id")):e.hide()&&a.show()&&_("#acym__walk-through-2__way-mail").val(_(".acym__walk-through-2__choose_external-server .walk-through_selected").attr("id"))}),s.off("click").on("click",function(){s.removeClass("walk-through_selected"),_(this).addClass("walk-through_selected"),"smtp"==_(this).attr("id")?t.show()&&i.hide():t.hide()&&i.show(),_("#acym__walk-through-2__way-mail").attr("value",_(this).attr("id"))}),(r=_(".acym__walk-through-2__button")).off("click").on("click",function(e){e.preventDefault(),r.addClass("unselected").removeClass("your_server_selected"),_(this).removeClass("unselected").addClass("your_server_selected"),_("#acym__walk-through-2__way-mail").attr("value",_(this).attr("id"))}),_(".acym__migrate__option").off("change").on("change",function(){k(),_(".acym__migrate__option:disabled").prop("checked",!1)}),k(),_("#acym__migrate__button").off("click").on("click",function(){f()}),_("#acym__migrate__restart_from_error__button").off("click").on("click",function(){window.scrollTo(0,0),_("#acym__migrate__result__error").hide(),_("#acym__migrate__result__error__message").html(""),f()}),_("#available_ports_check").off("click").on("click",function(e){e.preventDefault();var a=_(this).parent();a.html('<i class="acymicon-circle-o-notch acymicon-spin"></i>'),_.get(ACYM_AJAX_URL+"&ctrl=configuration&task=ports",function(_){a.html(_)})}),_("#acym__subscribe__news").on("click",function(){var e=_('input[type="email"]').val();if(!acym_helper.emailValid(e))return alert(ACYM_JS_TXT.email),!1;_(this).attr("disabled","true");var a=AJAX_URL_UPDATEME+"subscription&task=subscribe&email="+e+"&cms="+CMS_ACYM;_.get(a),_(".acy_button_submit").click()}),v(),_("#acym__walkthrough__list__new").on("click",function(){_(this).hide(),_("#acym__walkthrough__list__add-zone").show()}),_("#acym__walkthrough__list__add").on("click",function(){var e=_("#acym__walkthrough__list__new-address"),a=e.val();if(!acym_helper.emailValid(a))return alert(ACYM_JS_TXT.email),!1;var t='<input type="hidden" name="addresses[]" value="'+a+'"/>'+a;_("#acym__walkthrough__list__receivers").append("<tr><td>"+t+'</td><td><i class="acymicon-remove acym__walkthrough__list__receivers__remove"></i></td></tr>'),e.val(""),_("#acym__walkthrough__list__add-zone").hide(),_("#acym__walkthrough__list__new").show(),v()}),_("#acym__walkthrough__list__new-address").on("keypress",function(e){if(13===e.which)return _("#acym__walkthrough__list__add").click(),!1}),_("#acym__walkthrough__skip__fail").off("click").on("click",function(){_("[required]").removeAttr("required"),_('[type="email"]').attr("type","text"),_("#acym__walkthrough__skip").click()}),_(".acym__walkthrough__fail__choice").off("click").on("click",function(){var e=_(".acym__walkthrough__fail__"+_(this).attr("data-show"));if(e.is(":visible"))return!0;_(".selected").removeClass("selected"),_(this).addClass("selected"),_(".acym__walkthrough__fail__toggle-div").hide(),e.show(),_('[name="choice"]').val(_(this).attr("data-show")),_(".acym__walkthrough__fail__contact").is(":visible")?_('[name="email"]').attr("required","true"):_('[name="email"]').removeAttr("required")}),_(".acym__walkthrough__result__choice__one").off("click").on("click",function(){if(_(this).hasClass("selected"))return!0;_(".acym__walkthrough__result__choice__one").removeClass("selected"),_(this).addClass("selected"),"acym__walkthrough__result__choice__no"===_(this).attr("id")?_("#acym__walkthrough__result__spam").addClass("visible"):_("#acym__walkthrough__result__spam").removeClass("visible"),_('input[name="result"]').val(_(this).attr("data-value")),_('[data-task="saveStepResult"]').attr("disabled",!1)}),_(".acym__walkthrough__fail__gmail input").off("keypress").on("keypress",function(_){if(13==_.keyCode)return _.preventDefault(),!1}),acym_helperEditorWysid.initEditor(),acym_helperDynamic.setModalDynamics(),_.walkthroughList=function(){return 0!==_(".acym__walkthrough__list__receivers__remove").length||(alert(ACYM_JS_TXT.ACYM_AT_LEAST_ONE_USER),!1)}});