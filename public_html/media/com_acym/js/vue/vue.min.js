/**
 * @package    AcyMailing for Joomla
 * @version    6.6.1
 * @author     acyba.com
 * @copyright  (C) 2009-2019 ACYBA S.A.R.L. All rights reserved.
 * @license    GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html
 */

jQuery(document).ready(function(e){if(e("#acym__plugin__available__application").length>0){const i=(e,i)=>e.filter(e=>e.id!==i);new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__plugin__available__application",data:{allPlugins:[],displayedPlugins:[1],search:"",type:"",level:"",loading:!0,typesColors:{"Files management":"background-color: #C5EAFF;","E-commerce solutions":"background-color: #E7CEFF;","Content management":"background-color: #FFC1E9;","Subscription system":"background-color: #FFC7C7;",Others:"background-color: #FFF1BC;","User management":"background-color: #CAFFBA;","Events management":"background-color: #C2FFF9;"},noPluginTodisplay:!1,typingTimer:"",doneTypingInterval:1e3,currentLevel:"",downloading:{},allPluginsInstalled:{},pageDisplay:1,busy:!1},mounted:function(){this.getAllPlugins().then(i=>{if(void 0!==(i=e.acym_parseJson(i)).error)return e.acym_add_notification(i.error,"error"),!1;e.acym_config_get("level").then(t=>{if(void 0!==(t=e.acym_parseJson(t)).error)return e.acym_add_notification(t.error,"error"),!1;this.getAllPluginsInstalled().then(s=>{s=e.acym_parseJson(s),this.allPluginsInstalled=s.elements,this.currentLevel=t.data.toLowerCase(),this.allPlugins=this.handlePluginsInstalled(i),i=i.map(e=>{e.description=e.description.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />")}),this.setDownloading(),this.resetDisplay(),e('[name="acym__plugins__level"], [name="acym__plugins__type"]').select2({theme:"foundation",width:"100%"}),0===this.displayedPlugins.length&&(this.noPluginTodisplay=!0),this.loading=!1,setTimeout(()=>{this.$forceUpdate(),e.setTooltip()},400)})})})},methods:{getAllPlugins(){let i=AJAX_URL_UPDATEME+"integrationv6&task=getAllPlugin&cms="+CMS_ACYM;return e.post(i)},getAllPluginsInstalled(){let i=AJAX_URL_ACYM+"&ctrl=plugins&task=getAllPluginsAjax";return e.post(i)},download(i){if(this.downloading[i.id])return!0;this.downloading[i.id]=!0,this.downloading={...this.downloading};let t=AJAX_URL_ACYM+"&ctrl=plugins&task=download";e.ajax({url:t,type:"POST",data:{plugin:i}}).then(t=>{if(void 0!==(t=e.acym_parseJson(t)).error)return e.acym_add_notification(t.error,"error"),this.downloading[i.id]=!1,this.downloading={...this.downloading},!1;this.removeOnePluginToDownload(i.id),e.acym_add_notification(t.message,"info"),this.downloading[i.id]=!1})},removeOnePluginToDownload(e){this.allPlugins=i(this.allPlugins,e),this.displayedPlugins=i(this.displayedPlugins,e)},resetDisplay(){this.pageDisplay=1,this.fillDisplayPlugins()},fillDisplayPlugins(){this.displayedPlugins=this.filter().slice(0,18*this.pageDisplay),this.displayedPlugins=[...this.displayedPlugins]},rightLevel(e){return"starter"===e||("essential"===e&&-1!==["essential","enterprise"].indexOf(this.currentLevel)||"enterprise"===e&&"enterprise"===this.currentLevel)},ucfirst:e=>void 0===e?"":e.charAt(0).toUpperCase()+e.slice(1),setDownloading(){for(let e in this.allPlugins)this.downloading[this.allPlugins[e].id]=!1},filter(){return this.allPlugins.filter(e=>-1!==e.level.toLowerCase().indexOf(this.level.toLowerCase())&&-1!==e.category.toLowerCase().indexOf(this.type.toLowerCase())&&-1!==e.name.toLowerCase().indexOf(this.search.toLowerCase()))},handlePluginsInstalled(e){return void 0===this.allPluginsInstalled?e:e.filter(e=>-1===this.allPluginsInstalled.map(i=>e.file_name.replace(".zip","")===i.folder_name).indexOf(!0))},loadMorePlugins(){this.pageDisplay++,this.fillDisplayPlugins()},imageUrl:e=>(void 0!==e&&(e=e.substring(0,e.indexOf("."))),AJAX_URL_UPDATEME+"integrationv6&task=getImage&plugin="+e),documentationUrl:e=>void 0===e?"":(e=e.replace(".zip",""),AJAX_URL_UPDATEME+"integrationv6&task=getDocumentation&plugin="+e),isOverflown(e){return void 0===this.$refs.plugins||void 0===this.$refs.plugins[e]?"":this.$refs.plugins[e].scrollHeight>this.$refs.plugins[e].clientHeight?"acym__plugins__card__params_desc__overflown":""}},watch:{displayedPlugins(e,i){this.noPluginTodisplay=0===this.displayedPlugins.length&&1!==i[0]},search(e){clearTimeout(this.typingTimer),""===e?this.resetDisplay():this.typingTimer=setTimeout(()=>{this.resetDisplay()},this.doneTypingInterval)},type(){this.resetDisplay()},level(){this.resetDisplay()}}})}}),jQuery(document).ready(function(e){e("#acym__wysid__edit__button").length>0&&(Vue.component("vue-prism-editor",VuePrismEditor),new Vue({el:"#acym__wysid__editor__source",data:()=>({code:"",codeBase:"",language:"html",optionIndent:{indent_size:2,wrap_line_length:"120"},typingTimer:"",doneTypingInterval:1e3}),mounted(){let e=document.getElementById("acym__wysid__block__html__content");e.addEventListener("editor_change",()=>{this.changeCodeValue(void 0===html_beautify?e.value:html_beautify(e.value,this.optionIndent))})},methods:{changeCodeValue(e){this.code=e,this.codeBase=e},revert(){this.applyModification(this.codeBase),e("#acym__wysid__editor__source, #acym__wysid__right-toolbar__overlay").removeClass("acym__wysid__visible")},keep(){e("#acym__wysid__editor__source, #acym__wysid__right-toolbar__overlay").removeClass("acym__wysid__visible")},applyModification(i){let t=e(".acym__wysid__row__selector--focus");t.closest(".acym__wysid__row__element").find("> tbody").html(i),t.css("height",t.closest(".acym__wysid__row__element").css("height"))}},watch:{code(e){clearTimeout(this.typingTimer),this.typingTimer=setTimeout(()=>{this.applyModification(e)},this.doneTypingInterval)}}}))}),jQuery(document).ready(function(e){Vue.use(infiniteScroll);let i=0,t=[],s=[],l=0,n={available:20,selected:20};const a=(e,i,t)=>e.filter(e=>-1!==t.map(t=>-1!==e[t].toLowerCase().indexOf(i.toLowerCase())).indexOf(!0)),o=(e,i)=>e.filter(e=>e.id!==i),r=(e,i)=>e.filter(e=>e.id===i),d=e=>e.map(e=>parseInt(e.id));if(null!==document.getElementById("acym__entity_select")){new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__entity_select",data:{tableJoin:"",entitiesUnselected:[],data:{},columnJoin:"",offsetBase:5e3,entity:"",displaySelected:!0,loading:!0,entitiesToDisplay_available:[],columnsToDisplay:[],entitiesToDisplay_selected:[],entitiesAvailable:[],entitiesSelected:[],join:"",busy:!1,availableSearch:"",selectedSearch:"",displaySelectAll_available:!0,displaySelectAll_selected:!0},mounted:function(){let e=document.getElementById("acym__entity_select");e.style.display="flex",this.entity=e.getAttribute("data-entity"),this.columnsToDisplay=e.getAttribute("data-columns").split(","),this.join=e.getAttribute("data-join"),this.displaySelected="true"===e.getAttribute("data-display-selected"),this.columnJoin=e.getAttribute("data-column-join"),this.tableJoin=e.getAttribute("data-table-join"),this.data=JSON.parse(document.getElementById("acym__entity_select__data").value),this.handleEntities(this.data.elements),this.data.total<500?this.loading=!1:(i+=500,this.getAllEntities(this.entity))},methods:{selectEntity(e){let i=r(this.entitiesToDisplay_available,e)[0];this.entitiesToDisplay_selected.push(i),this.entitiesSelected.push(i),this.entitiesToDisplay_available=o(this.entitiesToDisplay_available,e),this.entitiesAvailable=o(this.entitiesAvailable,e),this.entitiesUnselected=o(this.entitiesUnselected,e)},unselectEntity(e){let i=r(this.entitiesToDisplay_selected,e)[0];this.entitiesToDisplay_available.push(i),this.entitiesUnselected.push(i),this.entitiesAvailable.push(i),this.entitiesToDisplay_selected=o(this.entitiesToDisplay_selected,e),this.entitiesSelected=o(this.entitiesSelected,e)},loadMoreEntity(e){n[e]+=20;let i="entitiesToDisplay_"+e,t="entities"+e.charAt(0).toUpperCase()+e.slice(1);this[i]=""===this[e+"Search"]?this[t].slice(0,n[e]):a(this["entities"+e.charAt(0).toUpperCase()+e.slice(1)],this[e+"Search"],this.columnsToDisplay[0])},loadMoreEntityAvailable(){this.loadMoreEntity("available")},loadMoreEntitySelected(){this.loadMoreEntity("selected")},moveAll(e){"available"===e?(this.entitiesSelected=this.entitiesSelected.concat(this.entitiesAvailable),this.entitiesAvailable=[],this.entitiesToDisplay_available=[],this.entitiesToDisplay_selected=this.entitiesSelected.slice(0,n.selected)):(this.entitiesAvailable=this.entitiesAvailable.concat(this.entitiesSelected),this.entitiesUnselected=this.entitiesUnselected.concat(this.entitiesSelected),this.entitiesSelected=[],this.entitiesToDisplay_available=this.entitiesAvailable.slice(0,n.available),this.entitiesToDisplay_selected=[])},doSearch(e){""===this[e+"Search"]?(this["displaySelectAll_"+e]=!0,n[e]=20,this["entitiesToDisplay_"+e]=this["entities"+e.charAt(0).toUpperCase()+e.slice(1)].slice(0,n[e])):(this["displaySelectAll_"+e]=!1,this["entitiesToDisplay_"+e]=a(this["entities"+e.charAt(0).toUpperCase()+e.slice(1)],this[e+"Search"],this.columnsToDisplay))},handleEntities(e){t=t.concat(e);let i=[];null!==this.columnJoin&&(i=((e,i)=>e.filter(e=>null!==e[i]))(e,this.columnJoin),s=s.concat(i)),this.entitiesAvailable=this.entitiesAvailable.concat(((e,i)=>e.filter(e=>-1===JSON.stringify(i).indexOf(JSON.stringify(e))))(e,i)),this.entitiesToDisplay_available.length<1&&(this.entitiesToDisplay_available=this.entitiesAvailable.slice(0,n.available)),this.displaySelected&&null!==this.columnJoin&&(this.entitiesSelected=this.entitiesSelected.concat(i),this.entitiesToDisplay_selected.length<1&&(this.entitiesToDisplay_selected=this.entitiesSelected.slice(0,n.selected)))},getAllEntities(t){let s="";void 0!==this.tableJoin&&void 0!==this.columnJoin&&(s="&join_table="+this.tableJoin+"."+this.columnJoin),e.get(AJAX_URL_ACYM+"&ctrl=entitySelect&task=loadEntityFront&offset="+i+"&perCalls=500&entity="+t+"&join="+this.join+"&columns="+this.columnsToDisplay.join(",")+s,e=>void 0!==(e=JSON.parse(e)).error?(console.log(e.error),!1):(l=e.data.total,"end"===e.data?(this.loading=!1,!0):(this.handleEntities(e.data.elements),i>l?(this.loading=!1,!0):(i+=500,this.getAllEntities(t),!0))))},finalLoad(){this.loading=!1,this.loadMoreEntity("available"),this.loadMoreEntity("selected");let i=document.getElementById("acym__entity_select__button__submit");void 0!==i&&null!=i&&i.classList.contains("acy_button_submit")&&e.setSubmitButtonGlobal(),e(".acym__entity_select__button__close").off("click").on("click",function(){e(this).closest(".reveal").foundation("close")}),e.setVerificationGenericImport(),e.setImportCMSLists()}},watch:{availableSearch:function(){this.doSearch("available")},selectedSearch:function(){this.doSearch("selected")},entitiesSelected(){let i=d(this.entitiesSelected);document.querySelector('[name="acym__entity_select__selected"]').value=JSON.stringify(i);let t=document.querySelector(".acym__campaign__recipients__number-recipients");void 0!==t&&null!=t&&function(i){let t=AJAX_URL_ACYM+"&page=acymailing_campaigns&ctrl=campaigns&task=countNumberOfRecipients";e.ajax({url:t,type:"POST",data:{listsSelected:i},beforeSend:function(){e(".acym__campaign__recipients__number-recipients").hide(),e(".acym_loader_logo").show()}}).done(function(i){e(".acym__campaign__recipients__number-recipients").html(i).show(),e(".acym_loader_logo").hide()}).error(function(){e(".acym__campaign__recipients__number-recipients").html(0)})}(i)},entitiesUnselected(){document.querySelector('[name="acym__entity_select__unselected"]').value=JSON.stringify(d(this.entitiesUnselected))},loading(e){e||this.finalLoad()}}})}}),jQuery(document).ready(function(e){if(Vue.component("vue-switch",{props:["plugin","ischecked"],data:function(){return{id:"vue-switch_",loading:!1,disabled:!1}},mounted:function(){this.id+=this.plugin.id},methods:{toggleActive(i){if(this.loading)return!0;this.loading=!0,this.disabled=!0;let t=AJAX_URL_ACYM+"&ctrl=plugins&task=toggleActivate&id="+i;e.get(t,i=>{if(void 0!==(i=e.acym_parseJson(i)).error)return e.acym_add_notification(i.error,"error"),!1;this.loading=!1,this.disabled=!1})}},template:'<div class="cell shrink grid-x"><div class="switch tiny cell shrink"> <input class="switch-input" :id="id" type="checkbox" name="exampleSwitch" :checked="ischecked"> <label class="switch-paddle" @click="toggleActive(plugin.id)" :for="id"> </label> </div><i v-show="loading" class="cell shrink acym__card__loader fa fa-circle-o-notch fa-spin"></i></div>'}),e("#acym__plugin__installed__application").length>0){const i=(e,i)=>e.filter(e=>e.id!==i);new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__plugin__installed__application",data:{allPlugins:[],displayedPlugins:[1],search:"",type:"",level:"",loading:!0,typesColors:{"Files management":"background-color: #C5EAFF;","E-commerce solutions":"background-color: #E7CEFF;","Content management":"background-color: #FFC1E9;","Subscription system":"background-color: #FFC7C7;",Others:"background-color: #FFF1BC;","User management":"background-color: #CAFFBA;","Events management":"background-color: #C2FFF9;"},noPluginTodisplay:!1,typingTimer:"",doneTypingInterval:1e3,currentLevel:"",downloading:{},pluginToggling:{},updating:{},pageDisplay:1,busy:!1},mounted:function(){e.acym_config_get("level").then(i=>{if(void 0!==(i=e.acym_parseJson(i)).error)return e.acym_add_notification(i.error,"error"),!1;let t=e.acym_parseJson(document.getElementById("acym__plugins__all").value);this.allPlugins=t.elements,this.currentLevel=i.data.toLowerCase(),this.resetDisplay(),0===this.displayedPlugins.length&&(this.noPluginTodisplay=!0),this.fillPluginToggling(),this.fillUpdating(),e.setSubmitButtonGlobal(),this.loading=!1,setTimeout(()=>{e.setTooltip(),this.$forceUpdate()},100)})},methods:{updatePlugin(i){if(this.updating[i.id])return!0;this.updating[i.id]=!0,this.updating={...this.updating};let t=AJAX_URL_ACYM+"&ctrl=plugins&task=update";e.ajax({url:t,type:"POST",data:{plugin:i}}).then(t=>{if(void 0!==(t=e.acym_parseJson(t)).error)return e.acym_add_notification(t.error,"error"),this.updating[i.id]=!1,this.updating={...this.updating},!1;e.acym_add_notification(t.message,"info"),this.updating[i.id]=!1,this.updating={...this.updating},this.toggleUptodateCurrentApp(i.id)})},removeOnePluginInApp(e){this.allPlugins=i(this.allPlugins,e),this.displayedPlugins=i(this.displayedPlugins,e)},resetDisplay(){this.pageDisplay=1,this.fillDisplayPlugins()},fillDisplayPlugins(){this.displayedPlugins=this.filterPlugin().slice(0,18*this.pageDisplay),this.displayedPlugins=[...this.displayedPlugins]},rightLevel(e){return"starter"===e||("essential"===e&&-1!==["essential","enterprise"].indexOf(this.currentLevel)||"enterprise"===e&&"enterprise"===this.currentLevel)},filterPlugin(){return this.allPlugins.filter(e=>-1!==e.level.toLowerCase().indexOf(this.level.toLowerCase())&&-1!==e.category.toLowerCase().indexOf(this.type.toLowerCase())&&-1!==e.folder_name.toLowerCase().indexOf(this.search.toLowerCase()))},toggleCurrentApp(e){this.allPlugins.map(i=>{i.id===e&&(i.active="1"===i.active?"0":"1")}),this.displayedPlugins=[...this.displayedPlugins]},toggleUptodateCurrentApp(e){this.allPlugins.map(i=>{i.id===e&&(i.uptodate="1"===i.uptodate?"0":"1")}),this.displayedPlugins=[...this.displayedPlugins]},deletePlugin(i){if(e.acym_confirm(ACYM_JS_TXT.ACYM_ARE_YOU_SURE_DELETE_ADD_ON)){let t=AJAX_URL_ACYM+"&ctrl=plugins&task=deletePlugin&id="+i;e.get(t,t=>void 0!==(t=e.acym_parseJson(t)).error?(e.acym_add_notification(t.error,"error"),!1):(e.acym_add_notification(t.message,"info"),this.removeOnePluginInApp(i),!0))}},fillPluginToggling(){for(let e in this.allPlugins)this.pluginToggling[this.allPlugins[e].id]=!1},fillUpdating(){for(let e in this.allPlugins)this.updating[this.allPlugins[e].id]=!1},transitionDelay:e=>"transition-delay: "+.1*e+"s;",isActivated:e=>1==e?"checked":"",loadMorePlugins(){this.pageDisplay++,this.fillDisplayPlugins()},imageUrl:e=>AJAX_URL_UPDATEME+"integrationv6&task=getImage&plugin="+e,documentationUrl:e=>AJAX_URL_UPDATEME+"integrationv6&task=getDocumentation&plugin="+e,isOverflown(e){return void 0===this.$refs.plugins||void 0===this.$refs.plugins[e]?"":this.$refs.plugins[e].scrollHeight>this.$refs.plugins[e].clientHeight?"acym__plugins__card__params_desc__overflown":""}},watch:{displayedPlugins(e,i){this.noPluginTodisplay=0===this.displayedPlugins.length&&1!==i[0]},search(e){clearTimeout(this.typingTimer),""===e?this.resetDisplay():this.typingTimer=setTimeout(()=>{this.resetDisplay()},this.doneTypingInterval)},type(){this.resetDisplay()},level(){this.resetDisplay()}}})}}),jQuery(document).ready(function(e){if(e("#requireConfirmation").length>0){let i=20,t=i,s=500;const l=["email","name"],n=(e,i,t)=>e.filter(e=>-1!==t.map(t=>-1!==e[t].toLowerCase().indexOf(i.toLowerCase())).indexOf(!0));new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__list__settings__subscribers",data:{subscribed:[],displayedSubscribers:[],busy:!1,listid:0,total:0,loading:!0,searchSubscribers:"",requireConfirmation:0},mounted:function(){this.requireConfirmation=document.getElementById("requireConfirmation").value;let e=document.getElementById("acym__list__settings__subscribers__listing");null!==e&&(e.style.display="flex"),this.subscribed=JSON.parse(document.getElementById("subscribers_subscribed").value),this.listid=document.querySelector('[name="id"]').value,this.total=this.subscribed.length,this.displayedSubscribers=this.subscribed.slice(0,t),this.total<s?this.loading=!1:this.getAllSubscribers()},methods:{loadMoreSubscriber(){t+=i,this.displayedSubscribers=""===this.searchSubscribers?this.subscribed.slice(0,t):n(this.subscribed,this.searchSubscribers,l)},getAllSubscribers(){e.get(AJAX_URL_ACYM+"&ctrl=lists&task=loadMoreSubscribers&offset="+this.total+"&perCalls="+s+"&listid="+this.listid,e=>{if(void 0!==(e=JSON.parse(e)).error)return console.log(e.error),!1;if(0===e.data.length)return this.loading=!1,!0;let i=e.data.length;return this.subscribed=this.subscribed.concat(e.data),this.total+=i,i<s?(this.loading=!1,!0):(this.getAllSubscribers(),!0)})},doSearch(){""===this.searchSubscribers?(t=i,this.displayedSubscribers=this.subscribed.slice(0,t)):this.displayedSubscribers=n(this.subscribed,this.searchSubscribers,l)},unsubscribeUser(i){let t=e("#acym_form");e('[name="acym__entity_select__selected"]').val(""),e('[name="acym__entity_select__unselected"]').val("["+i+"]"),t.find('[name="task"]').attr("value","saveSubscribers"),t.submit()}},watch:{searchSubscribers(){this.doSearch()}}})}}),jQuery(document).ready(function(e){e.fn.select2.defaults.set("theme","foundation"),Vue.component("select2",{template:'<div class="cell"><select :name="name"><option v-for="(option, key) in options" :value="key">{{ option }}</option></select></div>',props:["options","value","name"],mounted:function(){let i=this;e('[name="'+this.name+'"]').select2({theme:"foundation",width:"100%"}).val(this.value).trigger("change").on("change",function(){i.$emit("input",this.value)})},watch:{value:function(i){e('[name="'+this.name+'"]').val(i).trigger("change")},options:function(i){e('[name="'+this.name+'"]').select2({data:i})}},destroyed:function(){e('[name="'+this.name+'"]').off().select2("destroy")}})});