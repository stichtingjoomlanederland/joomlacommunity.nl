if(typeof(akeeba)=="undefined"){var akeeba={}}if(typeof(akeeba.jQuery)=="undefined"){akeeba.jQuery=jQuery.noConflict()}if(typeof admintools=="undefined"){var admintools={}}if(typeof admintools.ControlPanel=="undefined"){admintools.ControlPanel={graph:{from:"",to:"",exceptPoints:[],subsPoints:[],typePoints:[]},plots:[null,null],myIP:""}}(function(a){admintools.ControlPanel.loadGraphs=function(){admintools.ControlPanel.graph.from=document.getElementById("admintools_graph_datepicker").value;var b=new Date(admintools.ControlPanel.graph.from);b=new Date(b.getTime()+30*86400000);admintools.ControlPanel.graph.to=b.getUTCFullYear()+"-"+(b.getUTCMonth()+1)+"-"+b.getUTCDate();admintools.ControlPanel.graph.exceptPoints=[];admintools.ControlPanel.graph.subsPoints=[];admintools.ControlPanel.graph.typePoints=[];var d=a("#admintoolsExceptionsPieChart");d.empty();d.hide();admintools.ControlPanel.plots[1]=null;a("#akthrobber2").show();var c=a("#admintoolsExceptionsLineChart");c.empty();c.hide();admintools.ControlPanel.plots[0]=null;a("#akthrobber").show();admintools.ControlPanel.loadExceptionsLineGraph()};admintools.ControlPanel.loadExceptionsLineGraph=function(){var b="index.php?option=com_admintools&view=SecurityExceptions&datefrom="+admintools.ControlPanel.graph.from+"&dateto="+admintools.ControlPanel.graph.to+"&groupbydate=1&savestate=0&format=json&limit=0&limitstart=0";a.getJSON(b,function(c){a.each(c,function(d,e){admintools.ControlPanel.graph.exceptPoints.push([e.date,parseInt(e.exceptions*100)/100]);admintools.ControlPanel.graph.subsPoints.push([])});a("#akthrobber").hide();a("#admintoolsExceptionsLineChart").show();if(admintools.ControlPanel.graph.exceptPoints.length==0){a("#admintoolsExceptionsLineChartNoData").show();return}admintools.ControlPanel.renderExceptionsLineGraph();admintools.ControlPanel.loadExceptionsPieGraph()})};admintools.ControlPanel.loadExceptionsPieGraph=function(){var b="index.php?option=com_admintools&view=SecurityExceptions&datefrom="+admintools.ControlPanel.graph.from+"&dateto="+admintools.ControlPanel.graph.to+"&groupbydate=0&groupbytype=1&savestate=0&format=json&limit=0&limitstart=0";a.getJSON(b,function(c){a.each(c,function(d,e){admintools.ControlPanel.graph.typePoints.push([e.reason,parseInt(e.exceptions*100)/100])});a("#akthrobber2").hide();a("#admintoolsExceptionsPieChart").show();if(admintools.ControlPanel.graph.typePoints.length==0){a("#admintoolsExceptionsPieChartNoData").show();return}admintools.ControlPanel.renderExceptionsPieGraph()})};admintools.ControlPanel.renderExceptionsLineGraph=function(){a.jqplot.config.enablePlugins=true;admintools.ControlPanel.plots[0]=a.jqplot("admintoolsExceptionsLineChart",[admintools.ControlPanel.graph.subsPoints,admintools.ControlPanel.graph.exceptPoints],{show:true,axes:{xaxis:{renderer:a.jqplot.DateAxisRenderer,tickInterval:"1 week"},yaxis:{min:0,tickOptions:{formatString:"%.2f"}},y2axis:{min:0,tickOptions:{formatString:"%u"}}},series:[{yaxis:"y2axis",lineWidth:1,renderer:a.jqplot.BarRenderer,rendererOptions:{barPadding:0,barMargin:0,barWidth:5,shadowDepth:0,varyBarColor:0},markerOptions:{style:"none"},color:"#aae0aa"},{lineWidth:3,markerOptions:{style:"filledCircle",size:8},renderer:a.jqplot.hermiteSplineRenderer,rendererOptions:{steps:60,tension:0.6}}],highlighter:{show:true,sizeAdjust:7.5},axesDefaults:{useSeriesColor:true}}).replot()};admintools.ControlPanel.renderExceptionsPieGraph=function(){a.jqplot.config.enablePlugins=true;admintools.ControlPanel.plots[1]=a.jqplot("admintoolsExceptionsPieChart",[admintools.ControlPanel.graph.typePoints],{show:true,highlighter:{show:false},seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:true,dataLabels:"value"},markerOptions:{style:"none"}},legend:{show:true,location:"e"}}).replot()};admintools.ControlPanel.warnBeforePurgingSessions=function(b){if(!confirm(Joomla.JText._("COM_ADMINTOOLS_LBL_DATABASETOOLS_PURGESESSIONS_WARN"))){b.preventDefault();return false}};admintools.ControlPanel.showChangelog=function(){var b=a("#akeeba-changelog");b.modal("show")};admintools.ControlPanel.showUnblockMyself=function(){a.ajax("index.php?option=com_admintools&view=ControlPanel&task=selfblocked&tmpl=component",{data:{ip:admintools.ControlPanel.myIP},success:function(f){var c=f.match(/###([\s\S]*?)###/);var b=c[1];if(b==1){var e=a("#selfBlocked");var d=e.find("a");d.attr("href",d.attr("href")+"&ip="+admintools.ControlPanel.myIP);e.show()}}})};admintools.ControlPanel.showUpdateInformation=function(){a.ajax("index.php?option=com_admintools&view=ControlPanel&task=updateinfo&tmpl=component",{success:function(d,e,c){var b=d.match(/###([\s\S]*?)###/);data=b[1];if(data.length){a("#updateNotice").html(data)}}})};a(document).ready(function(b){admintools.ControlPanel.loadGraphs();admintools.ControlPanel.showUnblockMyself();admintools.ControlPanel.showUpdateInformation();b("#admintools_graph_reload").click(admintools.ControlPanel.loadGraphs);b("#optimize").click(admintools.ControlPanel.warnBeforePurgingSessions);b("#btnchangelog").click(admintools.ControlPanel.showChangelog)})})(akeeba.jQuery);